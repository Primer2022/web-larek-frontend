# Проектная работа "Веб-ларек" Интернет-магазин с товарами для веб-разработчиков

* Стек: HTML, SCSS, TS
* Для сборки используетс Webpack
* Архитектура: MVP

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Базовый код

### 1. Класс `Api`

Класс представляет собой обёртку для выполнения HTTP-запросов к API. Предоставляет методы для отправки запросов и обработки ответов.

**Поля:**

- `baseUrl` — строка, представляющая базовый URL для API.
- `options` — объект типа `RequestInit`, представляющий настройки запроса, такие как заголовки.

**Конструктор:**

- `baseUrl` — строка, базовый URL для API.
- `options` — объект `RequestInit`, настройки запроса (по умолчанию пустой объект).

При инициализации устанавливает заголовки `Content-Type` для JSON, а также объединяет их с любыми дополнительными заголовками, переданными в `options`.

**Методы:**

1. `protected handleResponse(response: Response): Promise<object>` — защищённый метод для обработки ответа от сервера. Если ответ успешный (статус 2xx), возвращает JSON-объект. В случае ошибки возвращает отклонённый промис с текстом ошибки или статусом.

2. `get(uri: string)` — метод для выполнения GET-запроса по указанному `uri`. Использует базовый URL и параметры запроса, установленные в `options`. После выполнения запроса возвращает результат обработки ответа.

3. `post(uri: string, data: object, method: ApiPostMethods = 'POST')` — метод для выполнения POST-запроса (или других методов POST, таких как PUT и DELETE) по указанному `uri`. Отправляет JSON-данные (`data`) в теле запроса. Использует базовый URL и параметры запроса, установленные в `options`. После выполнения запроса возвращает результат обработки ответа.

**Типы:**

- `ApiListResponse<Type>` — тип, представляющий ответ от API, содержащий общее количество элементов (`total`) и массив элементов (`items`) типа `Type`.
- `ApiPostMethods` — тип, представляющий возможные HTTP-методы для POST-запросов: `'POST'`, `'PUT'`, `'DELETE'`.

### Модуль `EventEmitter`

Модуль представляет собой реализацию брокера событий для управления подписками и триггерингом событий в приложении.

**Типы:**

- `EventName` — тип, представляющий название события. Может быть строкой или регулярным выражением (`RegExp`).
- `Subscriber` — тип, представляющий подписчика на событие. В данном случае это функция (`Function`).
- `EmitterEvent` — тип, представляющий событие с данными. Содержит свойства:
    - `eventName` — название события (`string`).
    - `data` — данные, переданные с событием (`unknown`).

**Интерфейс `IEvents`:**

- `on<T extends object>(event: EventName, callback: (data: T) => void): void` — метод для подписки на событие. При возникновении события вызывается `callback`, которому передаются данные типа `T`.
- `emit<T extends object>(event: string, data?: T): void` — метод для генерации события. Вызывает обработчики, подписанные на указанное событие, передавая данные `data`.
- `trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` — метод для создания функции-триггера, которая при вызове генерирует событие с объединёнными данными `context` и `data`.

**Класс `EventEmitter`:**

Реализует интерфейс `IEvents` и предоставляет стандартные методы для управления событиями.

**Поля:**

- `_events` — карта (`Map`), где ключом является название события (`EventName`), а значением — множество подписчиков (`Set<Subscriber>`).

**Методы:**

1. **`on<T extends object>(eventName: EventName, callback: (event: T) => void): void`**
    - Устанавливает обработчик (`callback`) для указанного события (`eventName`). Если событие не существует в `_events`, создаётся новая запись.

2. **`off(eventName: EventName, callback: Subscriber): void`**
    - Снимает обработчик (`callback`) с указанного события (`eventName`). Если для события больше не осталось подписчиков, оно удаляется из `_events`.

3. **`emit<T extends object>(eventName: string, data?: T): void`**
    - Генерирует событие с указанным именем (`eventName`) и данными (`data`). Вызывает все обработчики, подписанные на это событие или соответствующие регулярным выражениям.

4. **`onAll(callback: (event: EmitterEvent) => void): void`**
    - Устанавливает обработчик (`callback`) для всех событий. Использует специальное событие `"*"` для прослушивания всех событий.

5. **`offAll(): void`**
    - Удаляет все обработчики и очищает `_events`.

6. **`trigger<T extends object>(eventName: string, context?: Partial<T>): (event: object) => void`**
    - Создаёт функцию-триггер, которая при вызове генерирует событие с указанным `eventName` и объединёнными данными `context` и `event`.

## Компоненты модели данных (бизнес-логика)

### 1. Класс `BasketModel`

Класс представляет собой модель корзины, которая хранит информацию о добавленных товарах и управляет их количеством. Реализует интерфейс `IBasketModel`.

**Поля:**

- `items` — карта (`Map`), где ключом является идентификатор товара (`string`), а значением — количество данного товара в корзине (`number`).

**Конструктор:**

- `events` — экземпляр интерфейса `IEventEmmiter`, используется для отправки событий при изменении содержимого корзины.

**Методы:**

1. `add(id: string)` — метод для добавления товара в корзину по его идентификатору (`id`). Если товар уже существует в корзине, увеличивает его количество на единицу. Если товара ещё нет в корзине, добавляет его с количеством 1. После добавления вызывает приватный метод `_changed()`.

2. `remove(id: string)` — метод для уменьшения количества товара в корзине по его идентификатору (`id`). Если количество товара больше нуля, уменьшает его на единицу. Если количество товара становится равным нулю, удаляет товар из корзины. После удаления вызывает приватный метод `_changed()`.

3. `protected _changed()` — приватный метод, который уведомляет о изменениях в корзине, вызывая событие `basket:change` и передавая в нём текущие идентификаторы товаров в корзине (`items`).

### 2. Класс `CatalogModel`

Класс представляет собой модель каталога товаров, управляет коллекцией товаров и оповещает о изменениях. Реализует интерфейс `ICatalogModel`.

**Поля:**

- `items` — карта (`Map`), где ключом является идентификатор товара (`string`), а значением — объект товара (`IProduct`).

**Конструктор:**

- `events` — экземпляр интерфейса `IEventEmmiter`, используется для отправки событий при изменении содержимого каталога.

**Методы:**

1. `setItems(items: Map<string, IProduct>)` — метод для установки нового набора товаров в каталог. Обновляет карту товаров (`items`) и вызывает приватный метод `_changed()`.

2. `getProduct(id: string): IProduct` — метод для получения информации о товаре по его идентификатору (`id`). Возвращает объект товара (`IProduct`), соответствующий переданному идентификатору.

3. `protected _changed()` — приватный метод, который уведомляет о изменениях в каталоге, вызывая событие `catalog:change` и передавая в нём текущие идентификаторы товаров в каталоге (`items`).

### 3. Класс `ContactsModel`

Класс представляет собой модель контактной информации, содержащую данные о пользователе. Реализует интерфейс `IContacts`.

**Поля:**

- `email` — строка, представляющая электронную почту пользователя.
- `phone` — строка, представляющая номер телефона пользователя.

**Конструктор:**

- `email` — строка, представляющая электронную почту пользователя.
- `phone` — строка, представляющая номер телефона пользователя.

При инициализации устанавливает значения полей `email` и `phone` на основе переданных аргументов.

### 4. Класс `OrderModel`

Класс представляет собой модель заказа, содержащую информацию о способе оплаты и адресе доставки. Реализует интерфейс `IOrder`.

**Поля:**

- `payMethod` — строка, представляющая способ оплаты заказа.
- `address` — строка, представляющая адрес доставки.

**Конструктор:**

- `payMethod` — строка, представляющая способ оплаты заказа.
- `address` — строка, представляющая адрес доставки.

При инициализации устанавливает значения полей `payMethod` и `address` на основе переданных аргументов.

### 5. Класс `ProductModel`

Класс представляет собой модель продукта, содержащую информацию о товаре. Реализует интерфейс `IProduct`.

**Поля:**

- `id` — строка, представляющая уникальный идентификатор товара.
- `title` — строка, представляющая название товара.
- `category` — строка, представляющая категорию товара.
- `image` — строка, представляющая URL изображения товара.
- `price` — строка, представляющая цену товара.

**Конструктор:**

- `id` — строка, уникальный идентификатор товара.
- `title` — строка, название товара.
- `category` — строка, категория товара.
- `image` — строка, URL изображения товара.
- `price` — строка, цена товара.

При инициализации устанавливает значения полей `id`, `title`, `category`, `image`, и `price` на основе переданных аргументов.

## Компоненты представления

Классы использующиеся для отрисовки DOM-элементов

### 1. Класс `BasketItemView`

Класс представляет собой компонент для отображения отдельного товара в корзине. Реализует интерфейс `IView`.

**Поля:**

- `title` — элемент, отображающий название товара.
- `addButton` — кнопка для добавления товара в корзину.
- `removeButton` — кнопка для удаления товара из корзины.
- `id` — уникальный идентификатор товара (по умолчанию `null`).

**Конструктор:**

- `container` — контейнер, представляющий собой DOM-элемент, в котором находится элемент товара.
- `events` — экземпляр интерфейса `IEventEmmiter`, используется для обработки событий.

При инициализации, класс ищет в переданном контейнере необходимые элементы (`title`, `addButton`, `removeButton`) и устанавливает обработчики событий на кнопки:

- Клик по `addButton` вызывает метод `emit` у `events`, передавая событие `ui:basket-add` с идентификатором товара (`id`).
- Клик по `removeButton` вызывает метод `emit` у `events`, передавая событие `ui:basket-remove` с идентификатором товара (`id`).

**Методы:**

1. `render(data?)` — метод, который принимает объект с данными товара (свойства `id`, `title`). Если данные переданы, метод обновляет содержимое элементов, включая текст заголовка (`title`). После обновления данных, возвращает контейнер с элементом товара.

### 2. Класс `BasketView`

Класс представляет собой компонент для отображения корзины с товарами. Реализует интерфейс `IView`.

**Конструктор:**

- `container` — контейнер, представляющий собой DOM-элемент, в котором будет отображаться корзина.

**Методы:**

1. `render(data?)` — метод, который принимает объект с данными корзины (`items` — массив DOM-элементов). Если данные переданы, метод заменяет содержимое контейнера на переданные элементы. После этого возвращает контейнер с обновлённым содержимым.

### 3. Класс `CatalogItemView`

Класс представляет собой компонент для отображения одного товара в каталоге. Реализует интерфейс `IView`.

**Поля:**

- `cardButton` — кнопка карточки товара, отвечает за взаимодействие пользователя с элементом.
- `title` — заголовок карточки товара, отображает название товара.
- `category` — элемент, отображающий категорию товара.
- `image` — элемент для отображения изображения товара.
- `price` — элемент, отображающий цену товара.
- `id` — уникальный идентификатор товара (по умолчанию `null`).

**Конструктор:**

- `container` — контейнер, представляющий собой DOM-элемент, в котором находится карточка товара.
- `events` — экземпляр интерфейса `IEventEmmiter`, используется для обработки событий.

При инициализации, класс ищет в переданном контейнере необходимые элементы и устанавливает обработчик событий на `cardButton`, который при клике вызывает метод `emit` у `events`, передавая событие `ui:catalog-click` с идентификатором товара (`id`).

**Методы:**

1. `render(data?)` — метод, который принимает объект с данными товара (свойства `id`, `title`, `category`, `image`, `price`). Если данные переданы, метод обновляет содержимое элементов карточки товара, включая текст заголовка, категории, цены и изображение. После обновления данных, возвращает контейнер с отрисованным товаром.

### 4. Класс `CatalogView`

Класс представляет собой компонент для отображения списка товаров в каталоге. Реализует интерфейс `IView`.

**Конструктор:**

- `container` — контейнер, представляющий собой DOM-элемент, в котором будет отображаться список товаров.

**Методы:**

1. `render(data?)` — метод, который принимает объект с данными каталога (`items` — массив DOM-элементов). Если данные переданы, метод заменяет содержимое контейнера на переданные элементы. После этого возвращает контейнер с обновлённым списком товаров.

### 5. Класс `ContactsView`

Класс представляет собой компонент для отображения и управления контактной информацией, связанной с заказом. Реализует интерфейс `IView`.

**Поля:**

- `email` — строка, представляющая электронную почту пользователя.
- `phone` — строка, представляющая номер телефона пользователя.
- `orderButton` — кнопка для оформления заказа.

**Конструктор:**

- `container` — контейнер, представляющий собой DOM-элемент, в котором находятся элементы формы заказа.
- `events` — экземпляр интерфейса `IEventEmmiter`, используется для обработки событий.
- `order` — экземпляр модели `OrderModel`, представляющий текущий заказ.

При инициализации класс находит необходимые элементы в переданном контейнере, такие как поле ввода электронной почты (`email`), поле ввода телефона (`phone`) и кнопку для оформления заказа (`orderButton`). Кнопка `orderButton` получает обработчик событий, который при клике вызывает метод `emit` у `events`, передавая событие `ui:contacts-order` с текущими контактными данными (`email`, `phone`) и моделью заказа (`order`).

**Методы:**

1. `render(data?)` — метод, который принимает объект с контактными данными (`email`, `phone`). Если данные переданы, метод обновляет соответствующие поля. После этого возвращает контейнер с обновлённой информацией.

### 6. Класс `OrderView`

Класс представляет собой компонент для отображения и управления информацией о заказе. Реализует интерфейс `IView`.

**Поля:**

- `payMethod` — строка, представляющая выбранный метод оплаты.
- `address` — строка, представляющая адрес доставки.
- `orderButton` — кнопка для подтверждения заказа.

**Конструктор:**

- `container` — контейнер, представляющий собой DOM-элемент, в котором находятся элементы управления заказом.
- `events` — экземпляр интерфейса `IEventEmmiter`, используется для обработки событий.

При инициализации класс находит элементы управления заказом в переданном контейнере, такие как:

- Кнопки выбора метода оплаты (`payMethod`), где активной считается та, которая имеет класс `button_alt-active`.
- Поле ввода адреса доставки (`address`).
- Кнопка для подтверждения заказа (`orderButton`).

Кнопка `orderButton` получает обработчик событий, который при клике вызывает метод `emit` у `events`, передавая событие `ui:order` с выбранным методом оплаты (`payMethod`) и адресом доставки (`address`).

**Методы:**

1. `render(data?)` — метод, который принимает объект с данными заказа (`payMethod`, `address`). Если данные переданы, метод обновляет соответствующие поля. После этого возвращает контейнер с обновлённой информацией о заказе.